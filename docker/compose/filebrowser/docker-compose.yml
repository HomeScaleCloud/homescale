services:
  filebrowser:
    volumes:
      - root:/srv
      - /svc/filebrowser/database.db:/database.db
    image: filebrowser/filebrowser
    networks:
      traefik_proxy: null
    labels:
      - traefik.enable=true
      - traefik.http.services.filebrowser.loadbalancer.server.port=80
      - traefik.http.services.filebrowser.loadbalancer.server.scheme=http

      - traefik.http.routers.filebrowser.rule=Host(`files.morrislan.net`)
      - traefik.http.routers.filebrowser.service=filebrowser
      - traefik.http.routers.filebrowser.tls=true
      - traefik.http.routers.filebrowser.entrypoints=websecure
      - traefik.http.routers.filebrowser.tls.certresolver=myresolver
      - traefik.http.routers.filebrowser.middlewares=authentik@file

      - traefik.http.routers.filebrowser-share.rule=Host(`files.morrislan.net`) && ((PathPrefix(`/share/`)
      - traefik.http.routers.filebrowser-share.service=filebrowser
      - traefik.http.routers.filebrowser-share.tls=true
      - traefik.http.routers.filebrowser-share.entrypoints=websecure
      - traefik.http.routers.filebrowser-share.tls.certresolver=myresolver

      - traefik.docker.network=traefik_proxy

volumes:
  root:
    driver: local

networks:
  traefik_proxy:
    external: true