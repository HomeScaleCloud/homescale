apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../../base/manifests
  - pinniped-oidc.yaml
  - pinniped-secret.yaml

patches:
  - target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: pinniped-helm
    patch: |-
      - op: replace
        path: /spec/sources/0/helm/valuesObject/supervisor/enabled
        value: true

      - op: add
        path: /spec/sources/0/helm/valuesObject/supervisor/ingress
        value:
          enabled: true
          ingressClassName: nginx
          hostname: k8s.homescale.cloud
          path: /
          annotations:
            cert-manager.io/cluster-issuer: letsencrypt
          tls: true
