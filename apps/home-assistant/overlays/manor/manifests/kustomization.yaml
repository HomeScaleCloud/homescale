apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  annotations:
    avp-kustomize.kubernetes.io/path: "vaults/manor/items/home-assistant"

resources:
  - ../../../base/manifests
patches:
  - target:
      kind: Deployment
      name: home-assistant
      namespace: home-assistant
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: home-assistant
      spec:
        template:
          spec:
            containers:
              - name: home-assistant
                securityContext:
                  privileged: true
                volumeMounts:
                  - name: usb-tty0
                    mountPath: /dev/ttyUSB0
            volumes:
              - name: usb-tty0
                hostPath:
                  path: /dev/ttyUSB0
                  type: CharDevice
  - target:
      group: networking.k8s.io
      version: v1
      kind: Ingress
      name: home-assistant
      namespace: home-assistant
    patch: |-
      - op: replace
        path: /spec/rules/0/host
        value: ha.manor.homescale.cloud
      - op: replace
        path: /spec/tls/0/hosts
        value:
          - ha.manor.homescale.cloud
